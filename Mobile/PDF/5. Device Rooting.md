# 5.1. What is rooting
Rooting là một quá trình giúp bạn có được quyền truy cập "root" hoặc quyền hệ thống trên một thiết bị Android. Điều này tương đương với việc có tài khoản root trên một hệ thống Linux. Tuy nhiên, không giống như một hệ thống Linux thông thường, các nhà sản xuất và/hoặc nhà mạng không muốn người dùng có được mức độ truy cập này vào thiết bị của họ. Về cơ bản, đây là việc "bẻ khóa" thiết bị của chính bạn để có được sự linh hoạt hơn trong việc tùy chỉnh nó.

Vì nhiều nhà sản xuất thiết bị gốc (OEM) và/hoặc nhà mạng không muốn người dùng có quyền truy cập này, việc có được quyền truy cập root thường yêu cầu khai thác một lỗ hổng bảo mật trên thiết bị. Lỗ hổng này thường phải nằm trong một quá trình nào đó, vốn đã có quyền truy cập cấp hệ thống. Nếu không, có thể cần đến hai cuộc khai thác: một để có được quyền truy cập không có đặc quyền và một để nâng cấp quyền truy cập đó lên cấp hệ thống hoặc "root".

Những lỗ hổng này thường rất đặc thù cho từng thiết bị, phiên bản hoặc một đoạn mã cụ thể. Vì vậy, mặc dù có thể có một phương pháp đã được công bố để có quyền root trên một thiết bị, nhưng chưa chắc đã có phương pháp tương tự cho một thiết bị khác, ngay cả khi chúng cùng thế hệ. Sau khi khai thác lỗ hổng thành công, bước tiếp theo thường là sao chép tệp nhị phân `su` của Linux vào một vị trí được chỉ định trong biến môi trường PATH của người dùng, ví dụ như `/system/xbin`.

Tệp nhị phân `su` (substitute user) cho phép người dùng trở thành root hoặc các người dùng khác.
Sau khi cấu hình su với các quyền thích hợp, ứng dụng Android khác sẽ hỗ trợ xử lý các yêu cầu truy cập superuser hoặc root. 2 ứng dụng được dùng phổ biến nhất là Superuser và SuperSU, có sẵn trên Google Play Store.

Siêu tóm tắt:
Rooting: Quá trình giành quyền truy cập root trên thiết bị Android, giúp người dùng tùy chỉnh thiết bị linh hoạt hơn.
Phương pháp thực hiện:
Cần khai thác lỗ hổng trong các tiến trình có quyền hệ thống.
Đôi khi phải dùng hai bước: truy cập cơ bản và nâng quyền lên root.
Lỗ hổng thường đặc thù cho từng thiết bị hoặc phiên bản mã, nên không phải phương pháp nào cũng áp dụng cho mọi thiết bị.
Quy trình sau khi khai thác:
Tệp nhị phân su được sao chép vào thư mục trong biến môi trường PATH, như /system/xbin.
su cho phép xử lý các yêu cầu truy cập root thông qua ứng dụng hỗ trợ.
Ứng dụng hỗ trợ: Các ứng dụng phổ biến nhất là Superuser và SuperSU, dùng để quản lý quyền root và có sẵn trên Google Play Store.

2. Các vấn đề tiềm ẩn
(slide 9)
Quá trình root chứa đựng nhiều nguy hiểm tiềm tàng cả với những người dùng hiểu biết nhất. 
Nhiều người cả tin vô tình cung cấp phần mềm chất lượng, an toàn, không chứa mã độc cho người lạ qua mạng rồi bị root mất thiết bị cá nhân.

(slide 10)
Người dùng có thể gặp rủi ro do phần mềm lỗi, thiết kế kém hoặc bị khai thác bởi hacker, dẫn đến mất quyền kiểm soát thiết bị.

Siêu tóm tắt: Root thiết bị tiềm ẩn nhiều nguy cơ: rủi ro lỗi phần mềm, thiết kế kém, có thể bị hack => mất quyền kiểm soát thiết bị.

3. Tùy chỉnh ROMs
(slide 12)
1 số người dùng thay thế hệ điều hành đi kèm thiết bị của họ bằng firmware tùy chỉnh để kéo dài tuổi thọ của thiết bị, vượt qua giới hạn phần mềm được đặt ra, hoặc để truy cập vào mã nguồn Android mới nhất mà không cần chờ cập nhật.

(slide 13)
OmniROM và LineageOS là hai trong số các firmware tùy chỉnh phổ biến nhất và thường yêu cầu root thiết bị để chỉnh sửa bootloader.

(slide 14)
1 số nhà sản xuất cho phép người dùng chạy firmware tùy chỉnh, mở khóa bootloader theo cách được tài liệu hóa rõ ràng, an toàn và dễ dàng.
Nổi bật nhất là các thiết bị Nexus của Google.
(slide 15)
Bằng cách đó, Google tránh việc người dùng sử dụng các khai thác gây hại để truy cập vào chức năng root.
Các thiết bị Nexus không đi kèm với các bloatware được cài sẵn nên nhu cầu root thiết bị cũng giảm đi.

Siêu tóm tắt: 
Người dùng cài firmware tùy chỉnh như OmniROM hoặc LineageOS để nâng cao khả năng sử dụng thiết bị. Điều này cần root để chỉnh sửa bootloader, giúp thiết bị chạy firmware mới.
Google Nexus cho phép mở khóa bootloader dễ dàng và an toàn, giúp hạn chế root không cần thiết và rủi ro khai thác độc hại.

4. Ý nghĩa của việc rooting
(slide 17)
Khi đã root 1 thiết bị, bất kỳ ứng dụng nào trên đó cũng có thể yêu cầu quyền truy cập root.
Ứng dụng độc hại có thể gây thiệt hại không giới hạn cho phần mềm và dữ liệu người dùng nếu chiếm được quyền truy cập, bất kể bằng cách nào.

(slide 18)
Nền tảng của bảo mật Android là sự phân tách UID giữa các ứng dụng. Đây là yếu tố ngăn một ứng dụng thông thường sửa đổi cấu hình hệ thống.

Siêu tóm tắt: Việc root thiết bị Android cho phép các ứng dụng yêu cầu quyền root, bao gồm cả các ứng dụng độc hại và có thể dẫn đến nguy cơ phá hoại nghiêm trọng dữ liệu phần mềm của thiết bị. 1 yếu tố quan trọng trong bảo mật Android là hệ thống UID, giúp ngăn các ứng dụng thông thường can thiệp vào cấu hình hệ thống.

5. Root thử nghiệm
(slide 20)
Các nhà phát triển và chuyên gia kiểm thử bảo mật thường cần root thiết bị để kiểm tra hệ thống hoặc truy cập các tệp được bảo vệ.


(slide 21)
Trình giả lập thường đáp ứng đủ yêu cầu root, nhưng đôi khi nó quá chậm, bất tiện, hoặc không thể tái tạo tình huống cần kiểm thử.
Khi đó, thiết bị Nexus là giải pháp kiểm thử tốt để tránh sử dụng các phương pháp khai thác lỗ hổng. 

(slide 22 + 23)
Quy trình root mỗi thiết bị có sự khác biệt và thường yêu cầu nghiên cứu chi tiết nếu muốn thực hiện.
Cần cẩn thận khi cài đặt phần mềm liên quan đến root, vì chúng có thể ảnh hưởng tiêu cực đến bảo mật của máy tính hoặc thiết bị di động.

Siêu tóm tắt: 
Root thiết bị cho phép kiểm soát sâu hơn nhưng đi kèm rủi ro bảo mật cao, đặc biệt nếu ứng dụng độc hại lợi dụng quyền này.
Trình giả lập thường đủ để kiểm thử, nhưng khi cần thiết bị thật, nên dùng Nexus để tránh rủi ro.
Mỗi thiết bị có quy trình root khác nhau, cần nghiên cứu kỹ và cẩn thận với phần mềm liên quan để bảo vệ thiết bị cá nhân.


7. ANDROID BUILD PROCESS
1. Giới thiệu
Hiểu cách Android Studio biên dịch mã thành 1 ứng dụng giúp hiểu về quá trình hoạt động. Điều này cũng cho biết cách bảo vệ tính xác thực của ứng dụng và những trường hợp khiến nó không có giá trị.​

2. Biên dịch các ứng dụng
Có 2 bước chính trong quá trình xây dựng Android apps là: (compilation & packaging) và (signing). Quá trình này được thực hiện để kiểm tra/gỡ lỗi hoặc để phát hành trên Google Play hoặc các chỗ khác. Điểm khác biệt chính giữa hai tùy chọn này là ở bước signing.

Biên dịch sử dụng công cụ (Android Asset Packaging Tool aapt) để xử lý tài nguyên và tạo tệp R.java, giúp mã nguồn tham chiếu đến các tài nguyên, chuẩn bị cho việc compilation & packaging.

Trình biên dịch Java được sử dụng để chuyển đổi các tệp .java và .aidl thành tệp .class. Sau đó, các tệp .class này, cùng với các thư viện của bên thứ ba, được biên dịch thành tệp classes.dex. Tệp classes.dex, các tài nguyên đã biên dịch và các tài nguyên khác được hợp nhất bằng công cụ apkbuilder để tạo thành tệp Android Package (.apk).

3. Cấu trúc APK
Khi các ứng dụng Android được biên dịch, đầu ra là một tệp Android Package (APK). Đây là tệp nén chứa mã nguồn và tài nguyên của ứng dụng Android. Để kiểm tra nội dung, người dùng có thể đổi đuôi thành .zip và giải nén bằng các công cụ hỗ trợ.



