# 5.1. What is rooting
Rooting là một quá trình giúp bạn có được quyền truy cập "root" hoặc quyền hệ thống trên một thiết bị Android. Điều này tương đương với việc có tài khoản root trên một hệ thống Linux. Tuy nhiên, không giống như một hệ thống Linux thông thường, các nhà sản xuất và/hoặc nhà mạng không muốn người dùng có được mức độ truy cập này vào thiết bị của họ. Về cơ bản, đây là việc "bẻ khóa" thiết bị của chính bạn để có được sự linh hoạt hơn trong việc tùy chỉnh nó.

Vì nhiều nhà sản xuất thiết bị gốc (OEM) và/hoặc nhà mạng không muốn người dùng có quyền truy cập này, việc có được quyền truy cập root thường yêu cầu khai thác một lỗ hổng bảo mật trên thiết bị. Lỗ hổng này thường phải nằm trong một quá trình nào đó, vốn đã có quyền truy cập cấp hệ thống. Nếu không, có thể cần đến hai cuộc khai thác: một để có được quyền truy cập không có đặc quyền và một để nâng cấp quyền truy cập đó lên cấp hệ thống hoặc "root".

Những lỗ hổng này thường rất đặc thù cho từng thiết bị, phiên bản hoặc một đoạn mã cụ thể. Vì vậy, mặc dù có thể có một phương pháp đã được công bố để có quyền root trên một thiết bị, nhưng chưa chắc đã có phương pháp tương tự cho một thiết bị khác, ngay cả khi chúng cùng thế hệ. Sau khi khai thác lỗ hổng thành công, bước tiếp theo thường là sao chép tệp nhị phân `su` của Linux vào một vị trí được chỉ định trong biến môi trường PATH của người dùng, ví dụ như `/system/xbin`.

Tệp nhị phân `su` (substitute user) cho phép người dùng trở thành root hoặc các người dùng khác.
Sau khi cấu hình su với các quyền thích hợp, ứng dụng Android khác sẽ hỗ trợ xử lý các yêu cầu truy cập superuser hoặc root. 2 ứng dụng được dùng phổ biến nhất là Superuser và SuperSU, có sẵn trên Google Play Store.

# 5.2. Potential Issues
Quá trình root đầy rẫy những nguy hiểm tiềm ẩn, ngay cả đối với những người dùng có kinh nghiệm nhất. Nhiều khi, người dùng lại tin tưởng mù quáng vào những người lạ trên internet để nhận được phần mềm chất lượng, an toàn và không độc hại nhằm root thiết bị của họ.

Ngay cả khi những người phát triển phần mềm root không cố tình gây hại, họ vẫn có thể mắc lỗi và dễ dàng biến thiết bị của người dùng thành một cục gạch, hoặc do hướng dẫn sử dụng kém hoặc do phần mềm/lỗ hổng được thiết kế kém. Nếu họ có ý đồ xấu hoặc lơ là về bảo mật, thì người dùng coi như đã thất bại, bởi vì họ có thể đã vô tình trao quyền truy cập root thiết bị của mình cho hacker.

3. Custom ROMs

Một số người dùng cũng chọn thay thế hệ điều hành đi kèm với thiết bị của họ bằng một firmware tùy chỉnh. Việc này thường được thực hiện để kéo dài tuổi thọ của một thiết bị cũ, bỏ qua các hạn chế phần mềm do nhà mạng hoặc nhà sản xuất thiết bị gốc (OEM) đặt ra, hoặc để có quyền truy cập vào mã nguồn Android mới nhất mà không cần chờ nhà mạng phát hành bản cập nhật.

OmniROM và LineageOS là hai trong số những dòng firmware tùy chỉnh phổ biến nhất mà bạn có thể gặp. Trong nhiều trường hợp, việc này yêu cầu root thiết bị để sửa đổi bootloader, từ đó tải được firmware ROM tùy chỉnh.

Tuy nhiên, một số nhà sản xuất lại mở cửa cho phép người dùng cài đặt firmware tùy chỉnh. Họ cho phép mở khóa bootloader một cách dễ dàng, an toàn và có tài liệu hướng dẫn rõ ràng. Đáng chú ý nhất trong số đó là các thiết bị Nexus của Google.

Bằng cách cho phép mở khóa dễ dàng, Google đã loại bỏ nhu cầu cho người dùng phải sử dụng các lỗ hổng bảo mật tiềm ẩn để có quyền truy cập root. Ngoài ra, các thiết bị Nexus không cài đặt sẵn bloatware của nhà mạng, vì vậy nhu cầu root thiết bị cũng giảm đi.

4. Ý nghĩa của việc rooting
(slide 17)
Khi đã root 1 thiết bị, bất kỳ ứng dụng nào trên đó cũng có thể yêu cầu quyền truy cập root.
Ứng dụng độc hại có thể gây thiệt hại không giới hạn cho phần mềm và dữ liệu người dùng nếu chiếm được quyền truy cập, bất kể bằng cách nào.

(slide 18)
Nền tảng của bảo mật Android là sự phân tách UID giữa các ứng dụng. Đây là yếu tố ngăn một ứng dụng thông thường sửa đổi cấu hình hệ thống.

Siêu tóm tắt: Việc root thiết bị Android cho phép các ứng dụng yêu cầu quyền root, bao gồm cả các ứng dụng độc hại và có thể dẫn đến nguy cơ phá hoại nghiêm trọng dữ liệu phần mềm của thiết bị. 1 yếu tố quan trọng trong bảo mật Android là hệ thống UID, giúp ngăn các ứng dụng thông thường can thiệp vào cấu hình hệ thống.

5. Root thử nghiệm
(slide 20)
Các nhà phát triển và chuyên gia kiểm thử bảo mật thường cần root thiết bị để kiểm tra hệ thống hoặc truy cập các tệp được bảo vệ.


(slide 21)
Trình giả lập thường đáp ứng đủ yêu cầu root, nhưng đôi khi nó quá chậm, bất tiện, hoặc không thể tái tạo tình huống cần kiểm thử.
Khi đó, thiết bị Nexus là giải pháp kiểm thử tốt để tránh sử dụng các phương pháp khai thác lỗ hổng. 

(slide 22 + 23)
Quy trình root mỗi thiết bị có sự khác biệt và thường yêu cầu nghiên cứu chi tiết nếu muốn thực hiện.
Cần cẩn thận khi cài đặt phần mềm liên quan đến root, vì chúng có thể ảnh hưởng tiêu cực đến bảo mật của máy tính hoặc thiết bị di động.

Siêu tóm tắt: 
Root thiết bị cho phép kiểm soát sâu hơn nhưng đi kèm rủi ro bảo mật cao, đặc biệt nếu ứng dụng độc hại lợi dụng quyền này.
Trình giả lập thường đủ để kiểm thử, nhưng khi cần thiết bị thật, nên dùng Nexus để tránh rủi ro.
Mỗi thiết bị có quy trình root khác nhau, cần nghiên cứu kỹ và cẩn thận với phần mềm liên quan để bảo vệ thiết bị cá nhân.


7. ANDROID BUILD PROCESS
1. Giới thiệu
Hiểu cách Android Studio biên dịch mã thành 1 ứng dụng giúp hiểu về quá trình hoạt động. Điều này cũng cho biết cách bảo vệ tính xác thực của ứng dụng và những trường hợp khiến nó không có giá trị.​

2. Biên dịch các ứng dụng
Có 2 bước chính trong quá trình xây dựng Android apps là: (compilation & packaging) và (signing). Quá trình này được thực hiện để kiểm tra/gỡ lỗi hoặc để phát hành trên Google Play hoặc các chỗ khác. Điểm khác biệt chính giữa hai tùy chọn này là ở bước signing.

Biên dịch sử dụng công cụ (Android Asset Packaging Tool aapt) để xử lý tài nguyên và tạo tệp R.java, giúp mã nguồn tham chiếu đến các tài nguyên, chuẩn bị cho việc compilation & packaging.

Trình biên dịch Java được sử dụng để chuyển đổi các tệp .java và .aidl thành tệp .class. Sau đó, các tệp .class này, cùng với các thư viện của bên thứ ba, được biên dịch thành tệp classes.dex. Tệp classes.dex, các tài nguyên đã biên dịch và các tài nguyên khác được hợp nhất bằng công cụ apkbuilder để tạo thành tệp Android Package (.apk).

3. Cấu trúc APK
Khi các ứng dụng Android được biên dịch, đầu ra là một tệp Android Package (APK). Đây là tệp nén chứa mã nguồn và tài nguyên của ứng dụng Android. Để kiểm tra nội dung, người dùng có thể đổi đuôi thành .zip và giải nén bằng các công cụ hỗ trợ.



